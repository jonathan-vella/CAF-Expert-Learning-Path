# Execute the below via the run command in the Azure Portal to re-arm the SQL Server VM
# Update Password before executing
$VMName = "smarthotelSQL1"
$vm = Get-VM -Name $VMName 
do {
  if ($vm.state -eq "Off") { $vm | Start-VM }
  sleep -Seconds 5
  $ip = $vm.NetworkAdapters[0].IPAddresses[0]
} until ($ip)
Write-Output "Re-arm (extend eval license) for VM $VMName at $ip"
set-item wsman:\localhost\Client\TrustedHosts -value $ip -Force

# Replace string (item in quotes "") on next line with actual password before running
$secPassword = ConvertTo-SecureString "enter your lab password here" -AsPlainText -Force

$cred = New-Object System.Management.Automation.PSCredential ("Administrator", $secPassword)
Invoke-Command -ComputerName $ip -ScriptBlock { 
    slmgr.vbs /rearm
    net accounts /maxpwage:unlimited
    Restart-Computer -Force 
} -Credential $cred
